import requests
import matplotlib.pyplot as plt
from datetime import datetime

def get_commit_data(repo_owner, repo_name):
    api_url = f"https://api.github.com/repos/{repo_owner}/{repo_name}/commits"
    response = requests.get(api_url)
    
    if response.status_code == 200:
        commits = response.json()
        commit_dates = [commit['commit']['author']['date'] for commit in commits]
        commit_dates = [datetime.fromisoformat(date[:-1]) for date in commit_dates]
        commit_counts = {}
        for date in commit_dates:
            minute = date.replace(second=0, microsecond=0)
            commit_counts[minute] = commit_counts.get(minute, 0) + 1
        return commit_counts
    else:
        print(f"Erreur lors de la récupération des commits : {response.status_code}")
        return None

def plot_commit_data(commit_data):
    minutes = list(commit_data.keys())
    commit_count = list(commit_data.values())
    
    plt.figure(figsize=(12, 6))
    plt.plot(minutes, commit_count, marker='o', linestyle='-')
    plt.title('Quantité de commits effectués minute par minute')
    plt.xlabel('Temps')
    plt.ylabel('Nombre de commits')
    plt.grid(True)
    plt.show()

# Remplacez les valeurs suivantes par le propriétaire du dépôt et le nom du dépôt
repo_owner = "OpenRSI"
repo_name = "5MCSI_Metriques"

commit_data = get_commit_data(repo_owner, repo_name)
if commit_data:
    plot_commit_data(commit_data)
